# Vim

```bash
vim <file>
```

Можно посмотреть лекцию, где рассказывается про устройство vim-а и большинство шорткатов: [Lecture 3: Editors (vim) (2020)](https://www.youtube.com/watch?v=a6Q8Na575qc).

Кодовые текстовые редакторы отличаются от обычных, особенно `vim`. Поначалу скорость печати сильно замедлится.

Мотивация: в дальнейших курсах понадобится использовать текстовые редакторы для мелких файлов, так что лучше не затягивать и научиться сейчас пользоваться вимом, хотя бы базовые вещи.

**Важно**: большинство флагов и клавиш в vim-е имеют мнемонические правила, чтобы их было проще запоминать и держать в голове. Постарайтесь для себя тоже вывести какие-то соответствия, чтобы быстрее привыкнуть.

### Работа в vim

Vim &mdash; modal editor (mode == режим). Несколько самых важных режимов и как переходить между ними:

- `Normal` (`esc`) &mdash; домашний режим для навигации по файлу и перехода в другие режимы
- `Insert` (`i`) &mdash; редактирования кода
- `Replace` (`R`) &mdash; замена текста (не будем пользоваться)
- `Command Line` (`:`)
- Selections: `Visual` (`v`), `Visual Line` (`V`), `Visual Block` (`c-v`)

### Выход и сохранение изменений в vim-е

Для начала нужно выйти из любого другого режима и перейти в `Normal Mode`, нажав `esc`.

- `:q` (quit), `:qa` &mdash; выйти из vim (на самом деле закрыть окно/окна)
- `:q!` &mdash; выйти без сохранения
- `:w` (write) &mdash; сохранить изменения

### Навигация по файлу (Normal Mode)

- `h`, `j`, `k`, `l` &mdash; навигация по коду (можно и стрелками)
- `ctrl+u` (up), `ctrl+d` (down) &mdash; передвижение вверх/вниз (быстрее, чем стрелками)
- `G`, `gg` &mdash; перемещение в конец/начало файла
- `w` (word), `b` (beginning), `e` (end) &mdash; продвижение <вперёд/назад/в конец слова> через слово
- `0`, `^`, `$` (regex) &mdash; перемещение в <начало/первый
      непробельный символ/конец> строки (**можно использовать Home, End**)
- `<n>l` &mdash; передвижение к n-ому символу в строке
- `:<n>` &mdash; переход к строке n
- `H`, `M`, `L` &mdash; перемещение в верхнюю, среднюю и нижнюю часть экрана
- `f <char>`, `F <char>` (find) &mdash; переместиться вперёд/назад к первому совпадению `<char>`. Для передвижения по найденному можно использовать `,` (назад) и `;` (вперёд)
- `t <char>` / `T <char>` &mdash; TODO

### Редактирование/копирование/вставка/поиск (`Normal Mode`)

- `o`, `O` &mdash; создать новую строку ниже/выше курсора
- `d+w`, `d+e`, `d+d` &mdash; delete <word / end of word / whole line>. Также можно использовать <стрелки>, `home`, `end`.
- `c+e`, `c+c` &mdash; изменить конец слова / целую строку
- `x` &mdash; удалить символ
- `r` &mdash; заменить текущий символ
- `u` (undo), `ctrl+r` (redo) &mdash; отменить предыдущее изменение/отменить отмену. Одна команда отменяет ВСЁ, что мы делали в insert mode
- `y` (yank), `x`, `p/P` &mdash; copy/extract/paste. Для выделения текста удобно перейти в `Visual Mode`. У вима свой буфер, поэтому скопировать в буфер обмена без дополнительной настройки `.vimrc` скорее всего не получится
- `y+w`, `y+y` &mdash; copy word/line
- `d+i+[`, `d+i+(` &mdash; удалить всё внутри скобок
- `\%` &mdash; можно перемещаться вперёд/назад между скобками
- $\sim$ &mdash; изменение регистра выделенного текста
- `/` &mdash; поиск, `n` / `N` &mdash; для передвижения по найденному. `?` &mdash; обратный поиск (с конца файла)
- `gf`, `<C-w>f` &mdash; зайти в хедер в текущем/новом окне
- `gd` &mdash; перейти к определению функции, если она в том же файле

### Замена текста

Базовый синтаксис:

```text
:\%s/<old>/<new>/g
```

Объяснение:

- `\%` &mdash; замена во всём файле
- `g` &mdash; заменять все вхождения в одной строке

Узнать больше про `регулярные выражения` можно, погуглив **vim regex** или **python re**.

Несколько примеров:

- Как убрать `trailing spaces`:

  ```text
  :\%s/\s+\$//
  ```

  Если после замены не пропадает подсвечивание зон, совпадающих с регулярным выражением, можно ввести **:noh**.

- Замена текста по выделенной области, комментирование нескольких строк:

  ```text
  s/^/\/\//
  ```

- Изменить начальный отступ для нескольких строк: `shitf+v`, выделяем, потом `:` и пишем `<` или `>` чтобы убрать или добавить табы.

### Комбинации клавиш в `Command Line Mode`

- `:help <command>` &mdash; <command> может быть как `:w`, так и `w`
- `:qa` &mdash; закрыть все окна
- `:vsplit` &mdash; открыть тот же самый файл в новом окне. `ctrl+w+<стрелка вправо>` &mdash; перейти на окно справа. На втором окне можно написать `:e filename.txt` и откроется другой файл для редактирования

### Возможность создания нескольких окон и вкладок

- `:split` (`:sp`) &mdash; создать окно снизу
- `:vsplit` (`:vsp`) &mdash; создать окно справа
- `ctrl+w+[h, j, k, l]` &mdash; перемещение между окнами
- `:qa` &mdash; закрыть все окна

Можно вставлять цифры перед командами, чтобы выполнять несколько раз подряд (удобно для выделения).

Во время работы vim создаёт `swap` файл вида **.filename.swp**. Можно поменять директорию его расположения (`set directory` в `.vimrc`).

Конфигурация vim хранится в файле `~/.vimrc`. Посмотреть набор существующих опций можно здесь: [github basic.vim](https://github.com/amix/vimrc/blob/master/vimrcs/basic.vim). Также можно заглянуть в соседние файлы в репозитории. Неплохой файл для старта расположен в папке с текущим README.md: [.vimrc](.vimrc).

Выбор цветовой схемы: [vim-color-schemes](https://www.linode.com/docs/guides/vim-color-schemes/).

### Установка плагинов

- [vim-plug](https://github.com/junegunn/vim-plug?tab=readme-ov-file), [Vundle](https://github.com/VundleVim/Vundle.vim) &mdash; менеджеры плагинов (помогают устанавливать расширения). Расширения обычно ставятся в папку `.vim/bundle` или `.vim/plugged`. Подробности можно почитать на wiki на гитхабе vim-plug в секциях `Tutorial`, `Tips`.

- Установка `vim-plug`: [github installation](https://github.com/junegunn/vim-plug?tab=readme-ov-file#unix). Кратко: выполнить одну команду `curl` из туториала.

- Установка `Vundle`: [github quick start](https://github.com/VundleVim/Vundle.vim?tab=readme-ov-file#quick-start). Кратко: склонировать репу и добавить в `.vimrc` строку

  ```text
  set rtp+=~/.vim/bundle/Vundle.vim`
  ```

- Сами плагины можно посмотреть в соседнем с текущим ридми [.vimrc](.vimrc).

- [YouCompleteMe](https://github.com/ycm-core/YouCompleteMe) &mdash; автодополнение при наборе. Краткое описание можно найти [здесь](https://oleksii.shmalko.com/2014/youcompleteme-ultimate-autocomplete-plugin-for-vim/). Установка под linux: [link](https://github.com/ycm-core/YouCompleteMe/blob/master/README.md#linux-64-bit), но лучше посмотреть у меня в папке `soft`.

### TODO

- переобозначение горячих клавиш
- поиск кода и `.vimrc` на гитхабе
- vimtutor
- Запись и выполнение макросов
